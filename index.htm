<!DOCTYPE html>
<html>
    
    <head></head>
    
    <body>SCORE:
        <input id="lblScore" type="text" />
        <br/>
        TIME:
        <input id="lblTime" type="text" />
        <br/>
        <canvas id="canvas" height="600" width="600"></canvas>
		
		
        <script type="text/javascript">
            var context = canvas.getContext("2d");
            var shape=new Object();
            var board;
            var score;
            var pac_color;
            var start_time;
            var time_elapsed;    
            var interval;
            var m_currDirection = 4;

		Start();
			
            function Start() {
                board = new Array();
                score = 0;
                pac_color="yellow";
                var cnt = 100;
                var food_remain = 50;
                var pacman_remain = 1;
                start_time= new Date();
                //create the board - pacman and food .
                for (var i = 0; i < 10; i++) {
                    board[i] = new Array();
                    for (var j = 0; j < 10; j++) {
                        var randomNum = Math.random();
                        if (randomNum <= 1.0 * food_remain / cnt) {
                            food_remain--;
                            board[i][j] = 1;
                        } else if (randomNum < 1.0 * (pacman_remain + food_remain) / cnt) {
                            shape.i=i;
                            shape.j=j;
                            pacman_remain--;
                            board[i][j] = 2;
                        } else {
                            board[i][j] = 0;
                        }
                        cnt--;
                    }
                }
                keysDown = {};
                addEventListener("keydown", function (e) {
                    keysDown[e.keyCode] = true ;
                }, false);
                addEventListener("keyup", function (e) {
                    keysDown[e.keyCode] = false;
                }, false);
                interval=setInterval(UpdatePosition, 150);
            }

            function GetKeyPressed() {
                if (keysDown[38]) {
                    return 1;
                }
                if (keysDown[39]) {
                    return 4;
                }
                if (keysDown[40]) {
                    return 3;
                }
                if (keysDown[37]) {
                    return 2;
                }
            }

            function Draw() {
            	canvas.width=canvas.width; //clean board
                lblScore.value = score;
                lblTime.value = time_elapsed;

                for (var i = 0; i < 10; i++) {
                    for (var j = 0; j < 10; j++) {
                        var center = new Object();
                        center.x = i * 60 + 30;
                        center.y = j * 60 + 30;
                        if (board[i][j] == 2) {
                            context.beginPath();
                            context.arc(center.x, center.y, 30, (0.15-(m_currDirection)/2) * Math.PI ,(1.85-(m_currDirection)/2) * Math.PI); // half circle
                            context.lineTo(center.x, center.y);
                            context.fillStyle = pac_color; //color

                            //setRotation();
                            context.fill();
                            context.beginPath();
                            setPacmanEye(center.x,center.y);
                          //  context.arc(center.x - 15, center.y  - 5, 5, 0, 2 * Math.PI); // circle
                            context.fillStyle = "black"; //color 
                            context.fill();
                        } else if (board[i][j] == 1) {
                            context.beginPath();
                            context.arc(center.x, center.y, 15, 0, 2 * Math.PI); // circle
                            context.fillStyle = "black"; //color 
                            context.fill();
                        }
                    }
                }

               
            }

            function setPacmanEye( centerX , centerY){
                if(m_currDirection==1)
                {
                    context.arc(centerX +15,centerY  - 5, 5, 0, 2 * Math.PI);
                }
                if(m_currDirection==2)
                {
                    context.arc(centerX - 5, centerY  - 15, 5, 0, 2 * Math.PI);
                }
                if(m_currDirection==3)
                {
                    context.arc(centerX - 15, centerY  + 5, 5, 0, 2 * Math.PI);
                }
                if(m_currDirection==4)
                {
                    context.arc(centerX + 5, centerY  - 15, 5, 0, 2 * Math.PI);
                }

            }

            function UpdatePosition() {
            	board[shape.i][shape.j]=0;
                var x = GetKeyPressed();
                if(GetKeyPressed()!=null) {
                    m_currDirection = x;
                }
                if(x==1)
                {
                	if(shape.j>0)
                	{
                		shape.j--;
                	}
                }
                if(x==3)
                {
                	if(shape.j<9)
                	{
                		shape.j++;
                	}
                }
                if(x==2)
                {
                	if(shape.i>0)
                	{
                		shape.i--;
                	}
                }
                if(x==4)
                {
                	if(shape.i<9)
                	{
                		shape.i++;
                	}
                }
                if(board[shape.i][shape.j]==1)
                {
                	score++;
                }
                board[shape.i][shape.j]=2;
                var currentTime=new Date();
                time_elapsed=(currentTime-start_time)/1000;
            	if(score>=20&&time_elapsed<=10)
            	{
            		pac_color="green";
            	}
            	if(score==50)
            	{
            		window.clearInterval(interval);
            		window.alert("Game completed");
            	}
            	else
            	{
            		Draw();
            	}
            }
        </script>
    </body>

</html>